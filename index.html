<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>台電材料管理系統</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&family=Orbitron:wght@600;900&display=swap" rel="stylesheet" />
  <style>
    :root {
      --ukiyo-deep-blue: #1D3B56;
      --ukiyo-mid-blue: #2A587A;
      --ukiyo-light-blue: #6B93B8;
      --ukiyo-foam: #F0F4F5;
      --ukiyo-sky: #E6D3A3;
      --ukiyo-paper: #F2E6D9;
      --glass-bg: rgba(255, 255, 255, 0.85);
      --glass-border: rgba(255, 255, 255, 0.9);
      --danger-red: #d64545;
    }
    body {
      font-family: 'Noto Sans TC', sans-serif;
      margin: 0;
      padding: 0;
      color: #1a202c;
      overflow-x: hidden;
      background-color: var(--ukiyo-sky);
      min-height: 100vh;
      position: relative;
    }

    /* 背景動畫 */
    .ukiyo-scene {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
      background: radial-gradient(circle at 50% 30%, #f7f0e6, var(--ukiyo-sky));
    }
    .mt-fuji {
      position: absolute;
      bottom: 25%;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 150px solid transparent;
      border-right: 150px solid transparent;
      border-bottom: 200px solid #2c3e50;
      z-index: 1;
    }
    .mt-fuji::after {
      content: '';
      position: absolute;
      top: 60px;
      left: -150px;
      width: 300px;
      height: 140px;
      background: linear-gradient(to bottom, #fff 20%, transparent 80%);
      clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
      transform: scale(0.28) translateY(-320px);
    }
    .wave { position: absolute; bottom: 0; width: 200%; height: 100%; background-repeat: repeat-x; background-position: bottom; transform: translate3d(0, 0, 0); }
    .wave-back { z-index: 2; height: 45%; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 180' preserveAspectRatio='none'%3E%3Cpath d='M0,120 C150,150 250,80 400,110 C550,140 650,80 800,110 L800,180 L0,180 Z' fill='%232A587A' opacity='0.8'/%3E%3C/svg%3E"); animation: moveWave 25s linear infinite; }
    .wave-mid { z-index: 3; height: 40%; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 180' preserveAspectRatio='none'%3E%3Cpath d='M0,100 C200,60 350,140 600,80 C750,40 800,100 800,100 L800,180 L0,180 Z' fill='%236B93B8' opacity='0.9'/%3E%3C/svg%3E"); animation: moveWave 15s linear infinite reverse; }
    .wave-front { z-index: 4; height: 35%; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320' preserveAspectRatio='none'%3E%3Cpath fill='%231D3B56' fill-opacity='1' d='M0,160L48,176C96,192,192,224,288,224C384,224,480,192,576,165.3C672,139,768,117,864,128C960,139,1056,181,1152,197.3C1248,213,1344,203,1392,197.3L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E"); animation: moveWave 10s linear infinite; }
    @keyframes moveWave { 0% { transform: translateX(0); } 100% { transform: translateX(-50%); } }

    /* UI 內容 */
    .content-wrapper { position: relative; z-index: 10; padding: 0 16px 80px; }
    header { position: sticky; top: 15px; z-index: 100; max-width: 900px; margin: 20px auto; background: var(--ukiyo-deep-blue); color: white; border-radius: 12px; padding: 15px; display: flex; align-items: center; justify-content: center; box-shadow: 0 10px 25px rgba(29, 59, 86, 0.5); border: 2px solid #D4AF37; }
    .container-3d { background: var(--glass-bg); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); max-width: 950px; margin: 30px auto; border-radius: 20px; padding: 30px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); border: 1px solid var(--glass-border); }
    h3.section-title { color: var(--ukiyo-deep-blue); border-left: 6px solid var(--danger-red); padding-left: 15px; margin: 25px 0 15px; font-weight: 900; }
    input, select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem; box-sizing: border-box; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
    .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1.2fr; gap: 15px; margin-bottom: 15px; }
    .material-btn { padding: 12px; background: white; border: 1px solid #ddd; cursor: pointer; border-radius: 8px; text-align: center; transition: 0.2s; font-weight: 600; color: var(--ukiyo-deep-blue); }
    .material-btn.active { background: var(--ukiyo-mid-blue); color: white; }
    .btn-save { width: 100%; padding: 18px; border: none; border-radius: 12px; background: linear-gradient(45deg, var(--ukiyo-deep-blue), var(--ukiyo-mid-blue)); color: white; font-size: 1.2rem; font-weight: 900; cursor: pointer; transition: 0.3s; margin-top: 15px; }
    .btn-save:hover { background: var(--danger-red); transform: translateY(-2px); }

    /* 搜尋與歷史紀錄 */
    .search-box { background: rgba(29, 59, 86, 0.08); padding: 20px; border-radius: 15px; margin-bottom: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    #logList { display: none; margin-top: 20px; } /* 預設隱藏清單 */
    .record-li { background: white; border-radius: 12px; padding: 15px; margin-bottom: 12px; border-left: 5px solid var(--ukiyo-mid-blue); box-shadow: 0 4px 6px rgba(0,0,0,0.05); position: relative; }
    .btn-delete { background: none; border: none; color: #ccc; cursor: pointer; font-size: 1.2rem; transition: 0.2s; }
    .btn-delete:hover { color: var(--danger-red); }
    .btn-clear-all { grid-column: span 2; padding: 10px; background: none; border: 1px dashed var(--danger-red); color: var(--danger-red); border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 5px; }
    .btn-clear-all:hover { background: var(--danger-red); color: white; }
    .analysis-box { background: #fff; padding: 15px; border-radius: 10px; margin-top: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.04); }

    /* small helpers */
    .warn { color: var(--danger-red); font-weight:700; }
    .ok { color: green; font-weight:700; }

    /* 浮世繪風格製作人簽名 - 左下角 */
    .ukiyo-signature {
      position: fixed;
      left: 18px;
      bottom: 18px;
      z-index: 220;
      font-weight: 900;
      font-size: 0.95rem;
      padding: 10px 14px;
      border-radius: 8px;
      background: linear-gradient(135deg, rgba(242,230,217,0.95), rgba(230,211,163,0.95));
      border: 2px solid rgba(29,59,86,0.12);
      transform: rotate(-6deg);
      box-shadow: 0 8px 20px rgba(29,59,86,0.15);
      color: #1D3B56;
      text-shadow: 0 1px 0 rgba(255,255,255,0.6);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-family: 'Noto Sans TC', sans-serif;
      backdrop-filter: blur(3px);
    }
    .ukiyo-signature::after{
      content: "柯";
      display:inline-block;
      width:28px;
      height:28px;
      line-height:28px;
      text-align:center;
      font-weight:900;
      color:#fff;
      background: var(--danger-red);
      border-radius:4px;
      box-shadow: 0 3px 6px rgba(0,0,0,0.2);
      transform: translateY(-1px);
      font-family: 'Orbitron', sans-serif;
    }

    @media (max-width: 768px) {
      .form-row, .form-row-3, .search-box { grid-template-columns: 1fr; }
      .btn-clear-all { grid-column: span 1; }
      .ukiyo-signature { left: 10px; bottom: 10px; font-size: 0.85rem; transform: rotate(-4deg); }
    }
  </style>
</head>
<body>
  <div class="ukiyo-scene">
    <div class="mt-fuji"></div>
    <div class="wave wave-back"></div>
    <div class="wave wave-mid"></div>
    <div class="wave wave-front"></div>
  </div>

  <div class="content-wrapper">
    <header>
      <div style="font-weight:900; font-size: 1.4rem; letter-spacing: 2px;">台電材料管理系統</div>
    </header>

    <div class="container-3d">
      <form id="materialForm">
        <h3 class="section-title">壹、日期與類型</h3>
        <div class="form-row">
          <div><label>異動日期</label><input type="date" id="mainDate" required /></div>
          <div><label>借用日期 (無領料單填寫)</label><input type="date" id="borrowDate" /></div>
        </div>

        <div class="form-row">
          <div>
            <label>作業類型</label>
            <select id="transType">
              <option value="領料">領料 (Take)</option>
              <option value="借用">借用 (Borrow)</option>
              <option value="退料">退料 (Return)</option>
            </select>
          </div>
          <div><label>單號</label><input type="text" id="orderNo" placeholder="請輸入單號 (必填)" required /></div>
        </div>

        <h3 class="section-title">貳、人員與材料</h3>
        <div class="form-row">
          <input type="text" id="personName" placeholder="領/退/借用人姓名 (必填)" required />
          <input type="text" id="staffName" placeholder="發/收料經辦人 (必填)" required />
        </div>

        <div style="margin-top:10px">
          <label>料號 (Part No.)（選填）</label>
          <!-- 改為選填（移除 required） -->
          <input type="text" id="partNo" placeholder="請輸入料號（選填，範例：T68-0001）" />
        </div>

        <select id="category" onchange="renderMaterials()" style="margin-top:10px">
          <option value="">-- 選擇材料類別（選填） --</option>
          <option value="A">A 類 (礙子)</option>
          <option value="B">B 類 (鐵件)</option>
          <option value="C">C 類 (線材)</option>
          <option value="F">F 類 (變壓器)</option>
          <option value="H">H 類 (開關)</option>
          <option value="D">D 類 (電表)</option>
        </select>

        <div style="margin-top:15px">
        <label>選擇材料</label>
        <select id="materialSelect">
        <option value="">-- 請先選擇材料類別 --</option>
        </select>
        </div>

        <div id="qtySection" style="display:block; margin-top:20px;">
          <div class="form-row-3">
            <input type="number" id="qty" placeholder="數量 (必填)" min="1" required />
            <input type="text" id="unit" placeholder="單位 (PC/KG..)" required />
            <select id="evalType">
              <option value="">-- 評價類型 --</option>
              <option value="0新">(0新)</option>
              <option value="1舊">(1舊)</option>
              <option value="3(資產新)">3(資產新)</option>
              <option value="4(資產舊)">4(資產舊)</option>
            </select>
          </div>
          <button type="submit" class="btn-save">🌊 確認儲存紀錄</button>
        </div>
      </form>
    </div>

    <div class="container-3d" style="background: rgba(255, 255, 255, 0.75);">
      <h2 style="color:var(--ukiyo-deep-blue); text-align:center; margin-top:0">📋 歷史紀錄查詢</h2>
      <div class="search-box">
        <input type="text" id="searchPerson" placeholder="🔍 搜尋姓名..." onkeyup="handleSearch()">
        <input type="text" id="searchStaff" placeholder="🔍 搜尋經辦人..." onkeyup="handleSearch()">
        <input type="text" id="searchPartNo" placeholder="🔍 搜尋料號..." onkeyup="handleSearch()">
        <select id="searchYear" onchange="handleSearch()">
          <option value="">所有年份</option>
          <option value="2024">2024年</option>
          <option value="2025">2025年</option>
          <option value="2026">2026年</option>
        </select>
        <select id="searchMonth" onchange="handleSearch()">
          <option value="">所有月份</option>
        </select>
        <button class="btn-clear-all" onclick="clearAllRecords()">🗑️ 清除所有本地歷史紀錄</button>
      </div>

      <div id="logList"></div>

      <!-- 新增快速料號功能區 -->
      <div style="margin-top:18px; display:grid; grid-template-columns: 1fr 1fr; gap:12px;">
        <div class="analysis-box">
          <h4>🔎 即時庫存查詢</h4>
          <input type="text" id="queryPartNo" placeholder="輸入料號查詢庫存 (例：T68-0001)">
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button class="material-btn" onclick="queryInventory()">查詢庫存</button>
            <button class="material-btn" onclick="openBaselineDialog()">設定/調整初始庫存</button>
          </div>
          <div id="inventoryResult" style="margin-top:10px;"></div>
        </div>

        <div class="analysis-box">
          <h4>📊 存貨分析與預測</h4>
          <input type="text" id="analysisPartNo" placeholder="輸入料號進行歷史與預測分析">
          <div style="display:flex; gap:8px; margin-top:8px;">
            <button class="material-btn" onclick="analyzePart()">產生分析報告</button>
            <button class="material-btn" onclick="openThresholdDialog()">設定預警</button>
          </div>
          <div id="analysisResult" style="margin-top:10px;"></div>
        </div>
      </div>

      <!-- baseline & threshold dialogs (簡易 UI) -->
      <div id="dialogs" style="margin-top:12px"></div>
    </div>
  </div>

  <!-- 浮世繪風格製作人簽名（左下） -->
  <div class="ukiyo-signature" id="producer">
  製作人：<span hidden>柯文展</span>
</div>

<script>
  document.getElementById("producer").onclick = function () {
    const name = this.querySelector("span");
    name.hidden = !name.hidden;
  };
</script>


  <script>
    /* ======= 資料結構與初始資料 ======= */
   const rawData = {
A: ` 
1030420013	懸垂礙子 C型 10000磅 6"φ 灰色
1030420013	懸垂礙子 C型 10000磅 6"φ 灰色
1030420014	懸垂礙子 C型 15000磅 φ10" 灰色
1030480000	聚合裝腳礙子 11.4KV 夾線型
1030480007	防盬裝腳礙子 11.4KV 無腳
1030480007	防盬裝腳礙子 11.4KV 無腳
1030500000	聚合柱型礙子 11.4kV
1030500000	聚合柱型礙子 11.4kV
1030520001	拉線礙子 低壓 大型 L139.7㎜
1030520006	軸型礙子 低壓 軸型
1030520006	軸型礙子 低壓 軸型
`.trim().split('\n'),

B: `
1006000006	路燈開關 1P 240Vac 135A 非水銀式
1006000011	路燈開關 1P 240Vac 135A  電磁式
1006060005	點滅器 220Vac 5A 5~100lux
1006060005	點滅器 220Vac 5A 5~100lux
1012020037	電力保險絲 25kV 65E  12.5kA
1012020038	電力保險絲 25kV 125E  12.5kA
1012020038	電力保險絲 25kV 125E  12.5kA
1012020054	限流熔絲 15.5kV 40A 25kA  附抑弧開關
1012030005	電力保險絲組消音器 25KV 200A
1012030005	電力保險絲組消音器 25KV 200A
1012060002	熔絲鏈 3A H型 SURGE PROOF
1012060004	熔絲鏈 6A K型
1012060007	熔絲鏈 10A K型
1012060010	熔絲鏈 15A K型
1012060015	熔絲鏈 25A T型
1012060019	熔絲鏈 40A T型
1012060023	熔絲鏈 65A T型
1016000000	螺栓鎖 鎖鉤:5㎜φ 鎖鉤:鋁 螺栓:SS400 栓涵:鎂鋁矽合金
1016050113	開關箱 屋外型 不鏽鋼 600x400x230㎜ T2㎜
1028500019	配電線路電桿反光標語片 CNS 4345感壓型第1級 33x12㎝自黏式Y193
1028500025	配電線路電桿反光貼紙 PVC 40x10㎝ 蜂巢狀/黃色 自黏式
1028500186	配電線路電桿反光貼紙 非鍍層立方角錐之微稜鏡反射材料 90x100㎝ 黃黑相間色
1028500187	配電線路電桿反光貼紙 非鍍層立方角錐之微稜鏡反射材料 90x60㎝ 黃黑相間色
1028600042	電桿牌 鋁 220×90×T0.511㎜ 藍底白字
1028600042	電桿牌 鋁 220×90×T0.511㎜ 藍底白字
1028600062	電桿牌 鋁 220×90×T0.6㎜ 藍底白字
1030020030	被覆瓷罩 陶瓷 11.4KV桿上變壓器用 90φx95φxH95㎜
1104000184	壓接端子 銅 AWG #1 閉口型 短型 1孔 13㎜φ
1104000197	壓接端子 銅 250MCM 閉口型 短型 1孔 13㎜φ
1104000198	壓接端子 銅 250MCM 閉口型 短型 2孔 13㎜φ
1104000201	壓接端子 銅 500MCM 閉口型 長型 2孔 15㎜φ 屋外終端用
1104000202	壓接端子 銅 AWG 2/0 閉口型 短型 1孔 13㎜φ
1104000203	壓接端子 銅 AWG 2/0 閉口型 短型 2孔 13㎜φ
1104030022	壓接套管 銅 22㎜² 銅製
1104030025	壓接套管 銅 60㎜² 銅製
1104030026	壓接套管 銅 100㎜2 銅製
1104030037	壓接套管 銅 AWG 2/0 銅鍍錫
1104030038	壓接套管 銅 250MCM 銅鍍錫
1104030044	壓接套管 AAC AWG #2 鋁製
1104030045	壓接套管 AWG 4/0 鋁製
1104030046	壓接套管 AAC 300MCM 鋁製
1104030047	壓接套管 AAC 477MCM  鋁製
1104030072	跳線套管 AAC 477MCM(19) 鋁製
1104060000	C型壓接套管 銅製 銅14-22×8 α型
1104060001	C型壓接套管 銅製 銅14-38×14-38 β型
1104060002	C型壓接套管 銅製 銅60×8-38 α型
1104060002	C型壓接套管 銅製 銅60×8-38 α型
1104060003	C型壓接套管 銅製 銅60-100×60-100 β型
1104060004	C型壓接套管 銅製 銅60-125×22-60 β型
1104060005	C型壓接套管 銅製 銅2/0-250MCM×#4-2/0 β型
1104060007	H型壓接套管 鋁製 A#2-6,C38-14×A#2-#6,C38-14
1104060008	H型壓接套管 鋁製 A#2,C60-38×A#2-#6,C38-14
1104060014	H型壓接套管 鋁製 A4/0,C100×A4/0,C100
1104060015	H型壓接套管 鋁製 A4774/0,C200-125×A2/0#6,C60-14
1104060017	H型壓接套管 鋁製 A4774/0C200-125×A4/02/0C100-60
1104060018	H型壓接套管 鋁製 A477300C250150×A477300C250150
1104060022	C型壓接套管 銅製 銅250-250 β型
1104060023	C型壓接套管 銅製 銅125-125 β型
1104090000	接線環 銅線 6.5㎜φ
1104090002	接線環 AAC AWG #2-#6
1104090005	接線環 AAC 477MCM-AWG 4/0
1112120016	電桿綁帶 複合電桿用B型 φ235×75×6㎜
1112160000	電桿樁木固定帶 鐵製
1112160000	電桿樁木固定帶 鐵製
1112160003	四路檔拉帶 φ340㎜ 鐵製 雙桿合併用
1120100010	互連器 間接型A / 477MCM XLPE
1120100011	互連器 間接型B / AWG #2 XLPE
1120100012	互連繩 B型/ 112㎝
1120100013	互連繩 A型 / 52㎝
1120100014	互連器 夾條型A / 477MCM XLPE
1120100015	互連器 夾條型B / AWG #2 XLPE
1120120024	活線線夾 銅線 M8-60㎜2,T8-50㎜2
1120120024	活線線夾 銅線 M8-60㎜2,T8-50㎜2
1120140002	拉線夾板 銅線 22-38㎜²
1120140004	拉線夾板 銅線 50-80㎜2
1120140007	拉線夾板 銅線 100-150㎜²
1120140014	拉線夾板 鋁線 AWG 2/0-#2
1120140014	拉線夾板 鋁線 AWG 2/0-#2
1120140020	拉線夾板 鋁線 477MCM-300MCM-AWG 4/0
1120140020	拉線夾板 鋁線 477MCM-300MCM-AWG 4/0
1120240000	V型掛鐵 A型無縫 SS400
1120240000	V型掛鐵 A型無縫 SS400
1120240003	電容器組鐵架 單相 100KVAR 6台用 鍍鋅鋼
1120240007	低壓線架 單線式 鍍鋅鋼 附鐵閂
1120240007	低壓線架 單線式 鍍鋅鋼 附鐵閂
1120240009	低壓線架 三線式 鍍鋅鋼 附鐵閂
1120240009	低壓線架 三線式 鍍鋅鋼 附鐵閂
1120240011	低壓線架 五線式 鍍鋅鋼 附鐵閂
1120240011	低壓線架 五線式 鍍鋅鋼 附鐵閂
1120240015	伸出鐵架 標準式 鍍鋅鋼
1120260003	二孔鐵片 B型 220×38×T4.5㎜ 鍍鋅鐵
1120260003	二孔鐵片 B型 220×38×T4.5㎜ 鍍鋅鐵
1120260021	鐵閂 單眼 φ5/8"×1800㎜ 鐵鍍鋅
1120280001	頂梢 11kV 防盬裝腳礙子 SS400
1120280002	橫擔梢 11kV 防盬裝腳礙子  SS400
1120280002	橫擔梢 11kV 防盬裝腳礙子  SS400
1120320003	成型支線夾條 GSW 55㎜2 襯圈型 L890㎜
1120340014	橫擔押 L800㎜
1120340014	橫擔押 L800㎜
1120340019	角型橫擔押 L1000㎜
1120340021	角型橫擔押 L1420㎜
1120340023	角型橫擔押 L1745㎜
1122260057	支架 #1電纜固定帶用 L型 135×92.5×72×T3㎜ 304SST
1122260058	支架 500MCM電纜固定帶用 L型140x92.5x87xT3㎜ 304SST
1210000000	孔蓋定位標示器 66.3kHz 測深50㎝ H050型
1210000001	孔蓋定位標示器 169.8kHz 測深50㎝ H050型
1404010030	鍍鋅方頭螺栓 SGD30 M16×P2.0×140㎜ 附單螺帽
1404010032	鍍鋅方頭螺栓 SGD30 M16×P2.0×210㎜ 附單螺帽
1404010033	鍍鋅方頭螺栓 SGD30 M16×P2.0×240㎜ 附單螺帽
1404010034	鍍鋅方頭螺栓 SGD290-D M16×P2.0×270㎜ 附單螺帽
1404010035	鍍鋅方頭螺栓 SGD30 M16×P2.0×300㎜ 附單螺帽
1404010036	鍍鋅方頭螺栓 SGD30 M16×P2.0×350㎜ 附單螺帽
1404010038	鍍鋅方頭螺栓 SGD290-D M16×P2.0×450㎜ 附單螺帽
1404050083	鍍鋅方頭螺栓 SS400 5/8"-11UNCx40㎜ 附單螺帽
1404140000	鍍鋅全牙螺栓 SGD290-D M16xP2.0x450㎜ 附4只方螺帽
1404230039	碳鋼擴張螺栓 S45C H內牙外迫式 5/8"φx2-1/2"
1404310021	碳鋼單眼螺栓 SGD290-D M16xP2.0x270㎜ 附雙螺帽
1404310021	碳鋼單眼螺栓 SGD290-D M16xP2.0x270㎜ 附雙螺帽
1404310023	碳鋼單眼螺栓 SGD290-D M16xP2.0x450㎜ 附三螺帽
1404310026	碳鋼支線螺栓 SGD290-D M16xP2.0x500㎜ 附四螺帽
1404310028	碳鋼支線螺栓 SGD290-D M16xP2.0x300㎜ 附雙螺帽
1406010030	鍍鋅方墊圈 SS400 M16 18㎜φx4.5㎜ L52xW52㎜
1808360000	鉻酸鋅糊 1磅裝 材規Y413
1818050011	棉紗手套 棉紗含棉量100％ L250㎜ 電工用
1900000069	過載保護熔絲 13.8kV 25kVA 單相亭置式變壓器
1900000070	過載保護熔絲 6.9kV 25kVA/13.8kV 50kVA 單相亭置式變壓器
1900000070	過載保護熔絲 6.9kV 25kVA/13.8kV 50kVA 單相亭置式變壓器
1900000071	過載保護熔絲 6.9kV 50kVA/13.8kV 100kVA單相亭置式變壓器
1900000071	過載保護熔絲 6.9kV 50kVA/13.8kV 100kVA單相亭置式變壓器
1900000072	過載保護熔絲 6.9kV100kVA/13.8kV167kVA單相亭置式變壓器
1900000072	過載保護熔絲 6.9kV100kVA/13.8kV167kVA單相亭置式變壓器
1900000073	過載保護熔絲 6.9kV 167kVA 單相亭置式變壓器
`.trim().split('\n'),

C: ` 
1028560003	支線標示管 PE 34φxT2㎜xL1.8M
1030060071	電纜用塑膠帶 T0.178㎜xW19㎜xL20M
1030060072	電纜用塑膠帶 T0.178㎜xW38㎜xL20M
1030060074	自融性防水膠帶 T1.7㎜xW38㎜xL305㎝
1030060077	電纜用絕緣膠膏帶 T3.175㎜xW38.1㎜xL152㎝
1100010005	硬銅絞線(一般用) 22㎜²
1100010011	硬銅絞線(一般用) 60㎜²
1100010015	硬銅絞線(一般用) 100㎜²
1100010027	全鋁線 300MCM 19股
1100040000	鋼心鋁線 AWG #2 6/1
1102000000	15kV交連PE風雨線 1C AAC 477MCM 交連PE被覆 黑色
1102000001	15kV交連PE風雨線 1C ACSR AWG #2 交連PE被覆 黑色
1102000019	25KV交連PE電力電纜 1C 銅 AWG #1 銅線遮蔽 黑色PVC被覆
1102000019	25KV交連PE電力電纜 1C 銅 AWG #1 銅線遮蔽 黑色PVC被覆
1102000021	25KV交連PE電力電纜 1C 銅 500MCM 銅線遮蔽 黑色PVC被覆
1102000021	25KV交連PE電力電纜 1C 銅 500MCM 銅線遮蔽 黑色PVC被覆
1102000024	25KV交連PE電力電纜 1C銅AWG #1 銅線遮蔽 黑色PVC被覆加尼龍被覆
1102000025	25KV交連PE電力電纜 1C銅500MCM 銅線遮蔽 黑色PVC被覆加尼龍被覆
1102000035	25kV交連PE風雨線 1C ACSR AWG #2  交連PE被覆黑色
1102000043	25KV交連PE引接線 1C 銅 22㎜2 交連PE被覆 被覆顏色黑色
1102050055	600V PVC電線 1C 銅 22㎜2 黑色
1102050067	600V PVC電線 1C 銅 60㎜2 黑色
1102050089	600V PVC鋁風雨線 1C 鋁 AWG #2 灰色
1102050090	600V PVC鋁風雨線 1C 鋁 AWG #2 藍色
1102050093	600V PVC鋁風雨線 1C 鋁 AWG 4/0 藍色
1102050095	600V PVC風雨線 1C 銅 8㎜2 黑色
1102050097	600V PVC風雨線 1C 銅 22㎜2 黑色
1102050097	600V PVC風雨線 1C 銅 22㎜2 黑色
1102050099	600V PVC風雨線 1C 銅 60㎜2 黑色
1102050099	600V PVC風雨線 1C 銅 60㎜2 黑色
1102050101	600V PVC風雨線 1C 銅 125㎜2 黑色
1102050204	600V PVC接戶電纜 2C 銅 8㎜2
1102050206	600V PVC接戶電纜 2C 銅 22㎜2
1102050209	600V PVC接戶電纜 3C 銅 8㎜2
1102050211	600V PVC接戶電纜 3C 銅 22㎜2
1102100007	600V交連PE電纜 1C 銅 AWG 2/0 黑色
1102100007	600V交連PE電纜 1C 銅 AWG 2/0 黑色
1102100008	600V交連PE電纜 1C 銅 AWG 2/0 黃色
1102100008	600V交連PE電纜 1C 銅 AWG 2/0 黃色
1102100009	600V交連PE電纜 1C 銅 250MCM 黑色
1102100009	600V交連PE電纜 1C 銅 250MCM 黑色
1102100010	600V交連PE電纜 1C 銅 250MCM 黃色
1102100038	600V交連PE電纜 1C 鋁 250MCM 黑色
1108000001	軟銅紮線 2.6㎜φ 軟銅
1108000002	軟銅紮線 3.2㎜φ 軟銅
1108000005	PVC鋁紮線 AWG #4 鋁 PVC被覆
1108000006	PVC鋁紮線 AWG #6 鋁 PVC被覆
1108000007	鋁紮線 AWG #4 鋁
1108000008	鋁紮線 AWG #6 鋁
1114000022	預張式電纜終端接頭 屋外型 25kV 1C 銅 AWG #1
1114000024	預鑄型電纜終端接頭 屋外型 25kV 1C 銅 500MCM
1114000026	預張式電纜終端接頭 屋外型 25kV 1C 銅 500MCM
1114030000	預張式電纜直線接頭 600V 1C 銅 AWG 2/0
1114030001	預張式電纜直線接頭 600V 1C 銅 250MCM
1114030012	預鑄型電纜直線接頭 25kV 1C 銅 AWG #1
1114030014	預鑄型電纜直線接頭 25kV 1C 銅 500MCM
1114030018	預張式電纜分歧接頭 600V 1C 銅 AWG 2/0~250MCM
1114030019	灌膠式電纜分歧接頭 600V 1C 銅 AWG 2/0~250MCM
1114030039	預鑄型電纜直線接頭 25kV 1C 銅 AWG #1 套管免壓縮式
1114060001	套管插頭 25kV 200A AWG #1
1114060008	負載可切肘型端頭 25kV 200A AWG #1 有電壓測試點
1114060011	負載不可切肘型端頭 25kV 600A 500MCM 有電壓測試點
1114060015	插頭封套 25kV 200A AWG #1
1114060017	插頭封套 25kV 600A 500MCM
1114060019	雙通插頭 25kV 200A AWG #1
1114060021	雙通套管插頭 25kV 200A AWG #1
1114060025	四路分歧插頭 25kV 200A AWG #1
1114060026	四路分歧插頭 25kV 200A AWG #1 A類配電箱用
1114060028	隔離插頭 25kV 200A AWG #1
1114060028	隔離插頭 25kV 200A AWG #1
1120340001	素材木橫擔 L1200×90×90㎜
1120340002	素材木橫擔 L1800×90×90㎜
1120340002	素材木橫擔 L1800×90×90㎜
1120340008	接戶橫木 60×60㎜
1120340010	輕鋼橫擔 L1800×75×75×T2.3㎜
1120340010	輕鋼橫擔 L1800×75×75×T2.3㎜
1120340011	輕鋼橫擔 L2400×75×75×T2.3㎜
1122050001	電纜保護鐵 小型 SS400 3"φ L2500㎜
1122200007	電纜固定帶 #1 AWG 鋁合金 25KV AWG #1 單條
1122200014	電纜固定帶 500MCM 鋁合金 25KV 500MCM 單條
1124140000	管路封塞 RP-03型 80㎜φ 一般用
1124140002	管路封塞 RP-05型 125㎜φ 一般用
1124140003	管路封塞 PP-05型 125㎜φ 空管防水用
1124140004	管路封塞 RP-06型 150㎜φ 一般用
1124140005	管路封塞 PP-06型 150㎜φ 空管防水用
1124140006	管路封塞 PP-21型 150㎜φ 25KV AWG #1電纜防水用
1124140007	管路封塞 PP-25型 150㎜φ 25KV 500MCM電纜防水用
1124140008	管路封塞 PS-21型 150㎜φ 25KV AWG #1電纜防潛動用
1124140009	管路封塞 PS-25型 150㎜φ 25KV 500MCM電纜防潛動用
1124140032	管路封塞 PSN-25型 150㎜φ 25kV 500MCM 電纜防潛動用
1124140033	管路封塞 PSN-21型 150㎜φ 25kV AWG #1 電纜防潛動用
1400530108	鍍鋅等邊角鋼 SS400 90×90×T10㎜
1400530108	鍍鋅等邊角鋼 SS400 90×90×T10㎜
1400530151	鍍鋅等邊角鋼 SS400 90×90×T10×L1800㎜
1402010026	鍍鋅鐵線 SWM BWG#8 (φ4.19㎜)
1402030003	鍍鋅鋼絞線 55㎜² (φ3.2㎜×7股) 支線用 S撚
1600030012	PVC硬管 E52(2")
1600030035	PVC硬管 ES-1 80(3")
1610380004	UPVC管帽(管塞頭) 3"(80㎜)φ T2.7㎜ ES-1管
1610380005	UPVC管帽(管塞頭) 5"(125㎜)φ T4.1㎜ ES-1管
1610380006	UPVC管帽(管塞頭) 6"(150㎜)φ T5.1㎜ ES-1管
1804090005	石油醚 工業級 無色透明液 450mL裝
1808140035	電纜潤滑膏 5加侖裝 0~60℃ 材規Y221
1822810000	不鏽鋼束緊帶 304SST 0.2~0.3㎜×20㎜×1500㎜
1822810001	不鏽鋼束緊帶 304SST 0.2~0.3㎜×20㎜×1700㎜
1895020025	白細布 W3FT 12磅
`.trim().split('\n'),

" F: ` 
1000010059	桿上變壓器 單相 6.9kV 240/120V 10kVA
1000010064	桿上變壓器 單相 6.9kV 240/120V 25kVA
1000010066	改良套管型桿上變壓器 單相 6.9kV 240/120V 25kVA
1000010066	改良套管型桿上變壓器 單相 6.9kV 240/120V 25kVA
1000010067	密封型桿上變壓器 單相 6.9kV 240/120V 25kVA 不鏽鋼
1000010068	非晶質鐵心桿上變壓器 單相 6.9kV 240/120V 25kVA
1000010074	改良套管型桿上變壓器 單相 6.9kV 240/120V 50kVA
1000010074	改良套管型桿上變壓器 單相 6.9kV 240/120V 50kVA
1000010075	密封型桿上變壓器 單相 6.9kV 240/120V 50kVA 不鏽鋼
1000010076	非晶質鐵心桿上變壓器 單相 6.9kV 240/120V 50kVA
1000010079	桿上變壓器 單相 6.9kV 240/120V 100kVA
1000010080	改良套管型桿上變壓器 單相 6.9kV 240/120V 100kVA
1000010080	改良套管型桿上變壓器 單相 6.9kV 240/120V 100kVA
1000010081	密封型桿上變壓器 單相 6.9kV 240/120V 100kVA 不鏽鋼
1000010082	非晶質鐵心桿上變壓器 單相 6.9kV 240/120V 100kVA
1000010083	改良套管型桿上變壓器 單相 6.9kV 240/120V 167kVA
1000010083	改良套管型桿上變壓器 單相 6.9kV 240/120V 167kVA
1000010127	亭置式變壓器 單相 6.9/13.8kV 25kVA 直式高燃點一般型附分接頭
1000010131	亭置式變壓器 單相 6.9/13.8kV 25kVA 直式附分接頭
1000010133	亭置式變壓器 單相 6.9/13.8kV 50kVA 直式高燃點一般型附分接頭
1000010133	亭置式變壓器 單相 6.9/13.8kV 50kVA 直式高燃點一般型附分接頭
1000010139	亭置式變壓器 單相 6.9/13.8kV 100kVA直式高燃點一般型附分接頭
1000010139	亭置式變壓器 單相 6.9/13.8kV 100kVA直式高燃點一般型附分接頭
1000010171	亭置式變壓器 三相 12/24kV 500kVA 高燃點一般型附分接頭
1000010217	桿上變壓器 單相 6.9kV 240/120V 100kVA 不鏽鋼
1000010218	桿上變壓器 單相 6.9kV 240/120V 50kVA 不鏽鋼
1000010218	桿上變壓器 單相 6.9kV 240/120V 50kVA 不鏽鋼
1000010222	桿上變壓器 單相 6.9/13.8kV 240/120V 25kVA 不銹鋼
1000010225	桿上變壓器 單相 6.9/13.8kV 240/120V 167kVA 不銹鋼
1004030005	高壓電容器 單相 6.9kV 100kVAR 屋外型
1004030006	高壓電容器 單相 6.9kV 200kVAR 屋外型
1004030006	高壓電容器 單相 6.9kV 200kVAR 屋外型
1008010002	電容器用油開關 單相 14.4kV 200A 手動/電動 115Vac
1008010002	電容器用油開關 單相 14.4kV 200A 手動/電動 115Vac
1008040003	地下四路自動線路開關 三相 24kV 600A 2S2F 24V簡易型(I量測)
1008040009	地下四路自動線路開關 三相24kV600A 2S2F 24V標準型(V、I量測)
1008080005	亭置式氣封開關 三相 24kV 四路 2-600A 2-200A SF6絕緣
1008080013	亭置式開關 3相 24kV 二路 2-200A SF6絕緣 低碳鋼型
1008080016	亭置式氣封開關 三相 24kV 四路 3-600A 1-200A SF6絕緣
1016030015	高壓配電箱 屋外型 鐵 A類x1 單具組
1016030040	高壓配電箱 屋外型 不鏽鋼 A類x1 單具組
1016030040	高壓配電箱 屋外型 不鏽鋼 A類x1 單具組
1016030042	高壓配電箱 屋外型 不鏽鋼 B類J型
1016030043	高壓配電箱 屋外型 不鏽鋼 B類P型
1016030043	高壓配電箱 屋外型 不鏽鋼 B類P型
1030240010	變壓器絕緣油 35kV以上/2±0.03㎜ 145℃
1112000015	預力電桿 9m 配電 圓型 B級
1112000016	預力電桿 10.5m 配電 圓型 B級
1112000018	預力電桿 12m 配電 圓型 C級
1112000019	預力電桿 14m 配電 圓型 C級
1112000035	預力電桿 12m 配電 圓型 E級
1112100000	水泥腳木 空心圓形G3 φ150×1000㎜ 支線用
1112100000	水泥腳木 空心圓形G3 φ150×1000㎜ 支線用
1124020001	人孔蓋(含外蓋及蓋座)MC-150型外蓋φ908×80㎜蓋座φ1200×150㎜
1124020059	手孔蓋墊座 方型 1210x810x200㎜ 混凝土
1124060002	預力混凝土基樁 6000x250x50㎜
1124060002	預力混凝土基樁 6000x250x50㎜
3008240007	空油桶 <各種規格> R-1301
`.trim().split('\n'),   
 
H: ` 
1008040010	架空自動線路開關 三相 15kV 600A 24Vdc 標準型 閂鎖型無控制箱
1008040010	架空自動線路開關 三相 15kV 600A 24Vdc 標準型 閂鎖型無控制箱
1008040014	架空自動線路開關 三相 25.8kV 600A 24Vdc 標準型閂鎖型無控制箱
1008060002	手動型線路負載啟斷開關 三相 15kV 600A 屋外型 SF6
1008060022	負載啟斷開關 三相 25.8kV 600A 屋外型 SF6 手動型
1012010011	熔絲鏈開關 7.8/15kV 100A 10kA 屋外型 不鏽鋼固定架附被覆罩型
1012010013	聚合型熔絲鏈開關 15/27kV 100A 12kA 屋外型  附被覆罩
1012030002	電力保險絲座 25KV 200A 端子式
1012030003	電力保險絲座 25KV 200A 套管式
1012030013	限流熔絲座 15.5KV 200A 套管式
1012030015	限流熔絲座 15.5KV 200A 端子式
1014030008	配電級瓷套管避雷器 9KV 10KA 氧化鋅 無雷擊計數器 防鹽型
1014030027	配電級瓷套管避雷器 9kV 10kA 氧化鋅 無雷擊計數器 一般型
1014030028	配電級聚合套管避雷器 9KV 10KA 氧化鋅 無雷擊計數器
1030020003	高壓被覆罩 PE 11.4kV #2 H壓接型接線環用
1030020005	高壓被覆罩 PE 11.4kV #2 拉線夾板用(圓形開口)
1030020007	高壓被覆罩 PE 11.4kV 477MCM H壓接型接線環用
1030020009	高壓被覆罩 PE 11.4kV 477MCM 拉線夾板用(圓形開口)
1030020039	高壓被覆罩 PE 22.8kV 477C圓形開口 477MCM導線、拉線夾板用
1030020040	高壓被覆罩 PE 22.8kV 477H 477MCM導線、H壓接型接線環用
1030020041	高壓被覆罩 PE 22.8kV #2圓形開口 #2AWG導線、拉線夾板用
1030020042	高壓被覆罩 PE 22.8kV #2H #2AWG線、H壓接型接線環用
1030020045	被覆罩 矽橡膠 11.4/22.8kV 避雷器用
1100160003	接地銅棒 φ5/8"×L8' 附線夾
1100160003	接地銅棒 φ5/8"×L8' 附線夾
1120000009	U型軋頭 UC-501
1120000009	U型軋頭 UC-501
1204100003	線路故障指示器 單相 280A(600A) 1a 2指示燈 電池
1204100004	線路故障指示器 單相 800A(1000A) 1a 2指示燈 電池
1204100006	線路故障指示器 單相 800A 1指示燈 電池 FIC OV-A 架空線路
1404360028	碳鋼單眼螺帽 SGD290-D M16-N/A
`.trim().split('\n'),   

D: ` 
1002010000	低壓貫穿式比流器 0.3S級 600V 200:5A 15VA 乾式
1002010000	低壓貫穿式比流器 0.3S級 600V 200:5A 15VA 乾式
1002010002	低壓貫穿式比流器 0.3S級 600V 400:5A 15VA 乾式
1002010003	低壓貫穿式比流器 0.3S級 600V 600:5A 15VA 乾式
1002010003	低壓貫穿式比流器 0.3S級 600V 600:5A 15VA 乾式
1002010004	低壓貫穿式比流器 0.3S級 600V 800:5A 15VA 乾式
1002010004	低壓貫穿式比流器 0.3S級 600V 800:5A 15VA 乾式
1002010015	高壓計費用比流器 0.3S級 12kV 20:5A 15VA  乾式
1002010015	高壓計費用比流器 0.3S級 12kV 20:5A 15VA  乾式
1002010016	高壓計費用比流器 0.3S級 12kV 30:5A 15VA  乾式
1002010016	高壓計費用比流器 0.3S級 12kV 30:5A 15VA  乾式
1002010017	高壓計費用比流器 0.3S級 12kV 50:5A 15VA  乾式
1002010018	高壓計費用比流器 0.3S級 12kV 100:5A 15VA  乾式
1002010019	高壓計費用比流器 0.3S級 12kV 200:5A 15VA  乾式
1002010020	高壓計費用比流器 0.3S級 12kV 400:5A 15VA  乾式
1002010020	高壓計費用比流器 0.3S級 12kV 400:5A 15VA  乾式
1002010025	高壓計費用比流器 0.3S級 24kV 20:5A 15VA 乾式
1002010025	高壓計費用比流器 0.3S級 24kV 20:5A 15VA 乾式
1002010027	高壓計費用比流器 0.3S級 24kV 30:5A 15VA 乾式
1002010027	高壓計費用比流器 0.3S級 24kV 30:5A 15VA 乾式
1002010028	高壓計費用比流器 0.3S級 24kV 50:5A 15VA 乾式
1002010029	高壓計費用比流器 0.3S級 24kV 100:5A 15VA 乾式
1002010029	高壓計費用比流器 0.3S級 24kV 100:5A 15VA 乾式
1002010030	高壓計費用比流器 0.3S級 24kV 200:5A 15VA 乾式
1002010030	高壓計費用比流器 0.3S級 24kV 200:5A 15VA 乾式
1002030000	高壓計費用比壓器(非接地型) 0.3S級 12k:110V 25VA 乾式
1002030000	高壓計費用比壓器(非接地型) 0.3S級 12k:110V 25VA 乾式
1002030002	高壓計費用比壓器(非接地型) 0.3S級 24k:110V 25VA 乾式
1002030002	高壓計費用比壓器(非接地型) 0.3S級 24k:110V 25VA 乾式
1002050001	整套型變比器 單相二線0.3級92kV:115/65.7V 200×400:5A
1002050004	整套型變比器 三相三線 0.3S級 69kV:115V 50×100:5A O型
1002050005	整套型變比器 三相三線 0.3S級69kV:115V 100×200:5A O型
1002050007	整套型變比器 三相三線 0.3S級69kV:115V 200×400:5A O型
1002050008	整套型變比器 三相三線 0.3S級69kV:115V 400×800:5A O型
1006010012	時控開關 單相 120Vac 10~40A 7天 24時 15分
1310000008	瓦時計(用戶) 單相三線 110/220V 30A 指針型 附插座(100A)
1310000010	瓦時計(用戶) 三相三線 220V 2.5A 指針型
1310000013	瓦時計(用戶) 三相三線 220V 15A 指針型
1310000022	瓦時計(用戶) 三相四線 220V 15A 指針型
1310040000	電子式電表(用戶) 0.5級 單相三線 110/220V 30A
1310040000	電子式電表(用戶) 0.5級 單相三線 110/220V 30A
1310040001	電子式電表(用戶) 0.5級 三相四線 120~480V 2.5A
1310040002	電子式電表(用戶) 0.5級 三相四線 120~480V 2.5A 附記錄型
1310040003	電子式電表(用戶) 0.5級三相四線120~480V 2.5A雙向計量附記錄型
1310040005	電子式電表(用戶) 0.5級 三相四線120~480V 2.5A雙向計量智慧型
1310040006	電子式電表(用戶) 0.5級 三相四線 120~480V 30A
1310040006	電子式電表(用戶) 0.5級 三相四線 120~480V 30A
1310040007	電子式電表(用戶) 0.5級 三相四線 120~480V 30A 附記錄型
1310040011	電子式電表(用戶) 0.5級單相三線110~220V 30A 雙向計量附記錄型
1310040012	電子式電表(用戶) 0.5級三相四線120~480V 30A 雙向計量附記錄型
1310040022	電子式電表(用戶) 0.5級 單相三線 110/220V 30A單向計量附記錄型
1310040022	電子式電表(用戶) 0.5級 單相三線 110/220V 30A單向計量附記錄型
1310040027	模組化智慧型電表 0.5級 三相四線 110~480V 30A 雙向計量 斷復電
1310040027	模組化智慧型電表 0.5級 三相四線 110~480V 30A 雙向計量 斷復電
1310040028	模組化智慧型電表 0.5級 三相四線 110~480V 2.5A 雙向計量
1310040028	模組化智慧型電表 0.5級 三相四線 110~480V 2.5A 雙向計量
1310040029	模組化智慧型電表 0.5級 三相四線 110~480V 30A 雙向計量
1310040029	模組化智慧型電表 0.5級 三相四線 110~480V 30A 雙向計量
1310040030	模組化智慧型電表 0.5級 單相三線 110/220V 30A 雙向計量 附底座
1310040032	模組化智慧型電表 0.5級 單相三線 110/220V 30A 雙向計量
1310040032	模組化智慧型電表 0.5級 單相三線 110/220V 30A 雙向計量
1310070000	光學通訊埠 RS-232或USB 9600bps 無線裝置
1310080003	讀表介面單元 4G通訊模式(可向下相容3G/GPRS) 4具/日
1310240001	PCR封印鎖 A型 紅色字體 附鋼絲扣
1310240002	PCR封印鎖 B型 黑色字體 附鋼絲扣
1310300000	電表測試開關 600V 20A 7P
1310300001	電表測試開關 600V 20A 10P
1915000093	扣環 1AMB20008160 單相瓦時計 I-70S 中興
`.trim().split('\n')
  };
</script>

/* ======= 自動解析：將文字清單轉為陣列 ======= */
const materialDict = {};
Object.keys(rawData).forEach(key => {
    materialDict[key] = rawData[key]
        .split('\n')                // 依換行拆分
        .map(item => item.trim())   // 移除每行前後空格
        .filter(item => item !== ""); // 移除空行
});
     
  

       

    // records 格式與 localStorage 鍵
    // records 每筆物件結構:
    // { id, date, type, person, staff, item, partNo, qty, unit, evalType, orderNo }
    let records = JSON.parse(localStorage.getItem("ukiyo_db_v5") || "[]");
    let baselineStocks = JSON.parse(localStorage.getItem("ukiyo_baseline_v1") || "{}");
    let thresholds = JSON.parse(localStorage.getItem("ukiyo_thresholds_v1") || "{}");
    let selectedItem = "";

    function renderMaterials() {
      const cat = document.getElementById("category").value;
      const box = document.getElementById("materialsContainer");
      box.innerHTML = "";
      if (!cat) return;
      (materialDict[cat] || []).forEach(m => {
        const d = document.createElement("div");
        d.className = "material-btn";
        d.innerText = m;
        d.onclick = () => {
          selectedItem = m;
          document.getElementById("qtySection").style.display = "block";
          Array.from(box.children).forEach(c => c.classList.remove("active"));
          d.classList.add("active");
        };
        box.appendChild(d);
      });
    }

    /* 儲存邏輯（含料號與單號） */
    document.getElementById("materialForm").onsubmit = function (e) {
      e.preventDefault();
      const qtyVal = Number(document.getElementById("qty").value || 0);
      if (!qtyVal || qtyVal <= 0) {
        alert("請輸入正確數量");
        return;
      }
      // partNo 已改為選填：允許空字串
      const partNo = (document.getElementById("partNo").value || "").trim();
      const orderNo = (document.getElementById("orderNo").value || "").trim();
      if (!orderNo) {
        alert("請輸入單號");
        return;
      }
      const data = {
        id: Date.now(),
        date: document.getElementById("mainDate").value,
        type: document.getElementById("transType").value,
        person: document.getElementById("personName").value,
        staff: document.getElementById("staffName").value,
        item: selectedItem || "",
        partNo: partNo,
        qty: qtyVal,
        unit: document.getElementById("unit").value,
        evalType: document.getElementById("evalType").value,
        orderNo: orderNo
      };
      records.unshift(data);
      localStorage.setItem("ukiyo_db_v5", JSON.stringify(records));
      alert("✅ 紀錄已成功儲存！");
      // 重置部分表單
      document.getElementById("qty").value = "";
      document.getElementById("orderNo").value = "";
      handleSearch();
    };

    /* 搜尋與顯示歷史 */
    function handleSearch() {
      const sPerson = document.getElementById("searchPerson").value.trim();
      const sStaff = document.getElementById("searchStaff").value.trim();
      const sYear = document.getElementById("searchYear").value;
      const sMonth = document.getElementById("searchMonth").value;
      const sPart = document.getElementById("searchPartNo").value.trim();
      const list = document.getElementById("logList");
      // 如果所有搜尋條件都是空的，則隱藏清單
      if (!sPerson && !sStaff && !sYear && !sMonth && !sPart) {
        list.style.display = "none";
        return;
      }
      list.style.display = "block";
      renderHistory(sPerson, sStaff, sYear, sMonth, sPart);
    }

    function renderHistory(sPerson, sStaff, sYear, sMonth, sPart) {
      const list = document.getElementById("logList");
      list.innerHTML = "";
      const filtered = records.filter(r => {
        let rYear = "", rMonth = "";
        if (r.date) {
          const parts = r.date.split("-");
          rYear = parts[0] || "";
          rMonth = parts[1] || "";
        }
        return (sPerson === "" || (r.person && r.person.includes(sPerson)))
          && (sStaff === "" || (r.staff && r.staff.includes(sStaff)))
          && (sPart === "" || (r.partNo && r.partNo.includes(sPart)))
          && (sYear === "" || rYear === sYear)
          && (sMonth === "" || rMonth === sMonth);
      });

      if (filtered.length === 0) {
        list.innerHTML = "<p style='text-align:center; color:#999;'>查無相符紀錄</p>";
        return;
      }

      filtered.forEach(r => {
        const div = document.createElement("div");
        div.className = "record-li";
        div.innerHTML = `
          <div style="display:flex; justify-content:space-between; align-items:flex-start;">
            <div>
              <b>${r.date || ''}</b>
              <span style="color:var(--danger-red); border:1px solid var(--danger-red); padding:1px 6px; font-size:0.8em; border-radius:4px; margin-left:5px">${r.type}</span><br>
              <span style="color:var(--ukiyo-mid-blue); font-weight:bold; font-size:1.05em; display:block; margin-top:5px">${r.item || '未填名稱'}</span>
              <div style="margin-top:6px; font-size:0.9em;">料號: <b>${r.partNo || '未填'}</b> ｜ 單號: <b>${r.orderNo || '未填'}</b></div>
            </div>
            <div style="text-align:right">
              <button class="btn-delete" onclick="deleteRecord(${r.id})">🗑️</button>
            </div>
          </div>
          <div style="margin-top:10px; font-size:0.9em; border-top:1px dashed #eee; padding-top:8px; display:grid; grid-template-columns: 1fr 1fr;">
            <span>數量: <b>${r.qty}</b> ${r.unit || ''}</span>
            <span style="text-align:right">規格: <small>${r.evalType || '未填'}</small></span>
            <span>👤 ${r.person || ''}</span>
            <span style="text-align:right">🖊️ 經辦: ${r.staff || ''}</span>
          </div>
        `;
        list.appendChild(div);
      });
    }

    /* 刪除單筆 */
    function deleteRecord(id) {
      if (confirm("確定要刪除這筆紀錄嗎？此動作無法復原。")) {
        records = records.filter(r => r.id !== id);
        localStorage.setItem("ukiyo_db_v5", JSON.stringify(records));
        handleSearch();
      }
    }

    /* 全部刪除 */
    function clearAllRecords() {
      if (confirm("⚠️ 注意：這將會永久刪除此裝置上所有的歷史紀錄！\n您確定要繼續嗎？")) {
        const finalCheck = confirm("再次確認：真的要全部刪除嗎？");
        if (finalCheck) {
          records = [];
          localStorage.setItem("ukiyo_db_v5", JSON.stringify(records));
          alert("已清除所有紀錄。");
          handleSearch();
        }
      }
    }

    /* 初始設定日期 */
    document.getElementById("mainDate").valueAsDate = new Date();

    /* ======= 即時庫存與分析 ======= */
    function computeInventory(partNo) {
      const baseline = Number(baselineStocks[partNo] || 0);
      let inv = baseline;
      const relevant = records.filter(r => r.partNo === partNo).sort((a, b) => new Date(a.date) - new Date(b.date));
      relevant.forEach(r => {
        if (r.type === '領料' || r.type === '借用') inv -= Number(r.qty);
        else if (r.type === '退料') inv += Number(r.qty);
      });
      const usageByYear = {};
      relevant.forEach(r => {
        const yr = (r.date || '').split("-")[0] || 'unknown';
        const qty = Number(r.qty) || 0;
        if (!usageByYear[yr]) usageByYear[yr] = 0;
        if (r.type === '領料' || r.type === '借用') usageByYear[yr] += qty;
        else if (r.type === '退料') usageByYear[yr] -= qty;
      });
      return { inventory: inv, baseline, lastRecords: relevant.slice().reverse(), usageByYear };
    }

    function queryInventory() {
      const part = document.getElementById("queryPartNo").value.trim();
      const out = document.getElementById("inventoryResult");
      out.innerHTML = "";
      if (!part) {
        out.innerHTML = "<div style='color:#999'>請輸入料號</div>";
        return;
      }
      const res = computeInventory(part);
      const inv = res.inventory;
  

